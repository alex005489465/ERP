## ç›®æ¨™
- æ•´ç†æ–‡ä»¶çµæ§‹ï¼Œåšå¥½apiå±¤

## æ­¥é©Ÿ
- æ•´ç†æ–‡ä»¶çµæ§‹
- ç”¨ä¾‹ï¼Œæ–°å¢ä¸€ç­†åº«å­˜ç•°å‹•ï¼Œå…ˆä¸åŠ äº‹å‹™èˆ‡é–
  - ä¿®æ”¹åŸºç¤ç”¨ä¾‹
  - å¯¦ä½œåº«å­˜ç•°å‹•çš„ç”¨ä¾‹
  - å°æ­¤ç”¨ä¾‹é€²è¡Œå–®å…ƒæ¸¬è©¦
- ä¿®æ”¹apiå›æ‡‰æ¥å£ï¼Œæ”¹æˆdto
- å¯¦ä½œå…©å€‹æ§åˆ¶å™¨
  - index
  - å¯«stockæ§åˆ¶å™¨çš„è®Šæ›´åº«å­˜ï¼Œpost

## å‹•ä½œ
### èª¿æ•´æ–‡ä»¶çµæ§‹
```
src\core
â”œâ”€â”€ main
â”‚   â”œâ”€â”€ java
â”‚   â”‚   â””â”€â”€ core
â”‚   â”‚       â”œâ”€â”€ CoreApplication.java
â”‚   â”‚       â”œâ”€â”€ api
â”‚   â”‚       â”‚   â””â”€â”€ controller/
â”‚   â”‚       â”œâ”€â”€ application
â”‚   â”‚       â”‚   â”œâ”€â”€ service/
â”‚   â”‚       â”‚   â””â”€â”€ usecase/
â”‚   â”‚       â”œâ”€â”€ domain
â”‚   â”‚       â”‚   â”œâ”€â”€ entity/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Item.java
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Stock.java
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ StockMovement.java
â”‚   â”‚       â”‚   â”œâ”€â”€ enums/
â”‚   â”‚       â”‚   â”œâ”€â”€ model/
â”‚   â”‚       â”‚   â””â”€â”€ mapper/
â”‚   â”‚       â”œâ”€â”€ interface
â”‚   â”‚       â”‚   â”œâ”€â”€ controller/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ IApiResponse.java
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ IController.java
â”‚   â”‚       â”‚   â”œâ”€â”€ entity/
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ IEntity.java
â”‚   â”‚       â”‚   â”œâ”€â”€ model/
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ IModel.java
â”‚   â”‚       â”‚   â”œâ”€â”€ repository/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ IBaseRepository.java
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ IRedisHashRepository.java
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ IRedisKeyRepository.java
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ IRedisListRepository.java
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ IRedisStringRepository.java
â”‚   â”‚       â”‚   â””â”€â”€ usecase/
â”‚   â”‚       â”‚       â””â”€â”€ IUseCase.java
â”‚   â”‚       â”œâ”€â”€ library
â”‚   â”‚       â”‚   â””â”€â”€ base/
â”‚   â”‚       â”‚       â”œâ”€â”€ BaseController.java
â”‚   â”‚       â”‚       â”œâ”€â”€ BaseEntity.java
â”‚   â”‚       â”‚       â”œâ”€â”€ BaseModel.java
â”‚   â”‚       â”‚       â”œâ”€â”€ BaseRepository.java
â”‚   â”‚       â”‚       â””â”€â”€ BaseUseCase.java
â”‚   â”‚       â”œâ”€â”€ repository
â”‚   â”‚       â”‚   â”œâ”€â”€ repository/
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ CommonRepository.java
â”‚   â”‚       â”‚   â””â”€â”€ redis/
â”‚   â”‚       â”‚       â””â”€â”€ RedisRepository.java
â”‚   â”‚       â””â”€â”€ bootstrap/
â”‚   â”‚           â””â”€â”€ (å·²ç§»è‡³ CoreApplication.java é ‚å±¤)
â”‚   â””â”€â”€ resources
â”‚       â””â”€â”€ application.yml
â””â”€â”€ test
    â”œâ”€â”€ java
    â”‚   â””â”€â”€ core
    â”‚       â”œâ”€â”€ CoreApplicationTests.java
    â”‚       â””â”€â”€ repository
    â”‚           â””â”€â”€ redis
    â”‚               â””â”€â”€ RedisRepositoryTest.java
    â””â”€â”€ resources

```
### ç”¨ä¾‹
#### æ–‡ä»¶çµæ§‹
```
main.java.core.interface.usecase
â”œâ”€â”€ dto/                                // ç”¨ä¾‹ç›¸é—œ DTO æ”¾é€™
â”‚    â”œâ”€â”€ CreateStockMovementInput.java  
â”‚    â””â”€â”€ CreateStockMovementOutput.java                        
â””â”€â”€ ICreateStockMovementUseCase.java    // ç”¨ä¾‹æ¥å£ï¼Œextends IUseCase<Input, Output>
```
```
main.java.core.application.usecase
â””â”€â”€ CreateStockMovement.java  // implements ICreateStockMovementUseCase
```
```
test.java.core.application.usecase
â””â”€â”€ CreateStockMovementTest.java
```
#### Use Caseï¼šæ–°å¢ä¸€ç­†åº«å­˜ç•°å‹•
```pgsql
1. æŸ¥è©¢ & æ›´æ–° stock æ•¸é‡ï¼ˆæ ¹æ“š stock_movementsï¼‰
2. å¯«å…¥ stock_movementsï¼ˆä¿å­˜åŸå§‹æ“ä½œè¨˜éŒ„ï¼‰
```
```
åœ¨ `maintask()` æ–¹æ³•ä¸­æŒ‰é †åºèª¿ç”¨å…¶ä»–è¼”åŠ©æ–¹æ³•ï¼š

1. `validateInput()` - é©—è­‰è¼¸å…¥åƒæ•¸
2. `getCurrentStockQuantity()` - æŸ¥è©¢ç•¶å‰åº«å­˜
3. `calculateNewQuantity()` - è¨ˆç®—æ–°æ•¸é‡
4. `validateBusinessRules()` - é©—è­‰æ¥­å‹™è¦å‰‡
5. `updateStockQuantity()` - æ›´æ–°åº«å­˜
6. `createStockMovementRecord()` - å‰µå»ºç•°å‹•è¨˜éŒ„
7. `createSuccessResult()` æˆ– `createFailureResult()` - ç”Ÿæˆçµæœ
```

### ä¿®æ”¹åŸºç¤ç”¨ä¾‹çš„æ¥å£èˆ‡å¯¦ç¾
- æ–°å¢ä¸€å€‹æ–¹æ³•`maintask()`ï¼Œè£¡é¢æ”¾è¦åŸ·è¡Œçš„é‚è¼¯
- èª¿ç”¨çš„åœ°æ–¹ä½¿ç”¨`excute()`ä¾†æ¿€æ´»ç”¨ä¾‹
- `excute()`å…§ï¼Œé‹è¡Œ`maintask()`ï¼Œå­é¡ä¸å¯è¦†è“‹ï¼Œåˆ°æ™‚å€™æœ‰å•¥è¦åœ¨åŸ·è¡Œå‰å¾Œæ·»åŠ çš„ï¼Œå†é€™è£¡é¢è¨­ç½®é‰¤å­ 

### ä¿®æ”¹apiå›æ‡‰
#### å›æ‡‰é«”
- å°‡ `IApiResponse.java`é€™å€‹æ¥å£ï¼ˆInterfaceï¼‰è½‰æ›ç‚ºä¸€å€‹å…·é«”çš„ DTO é¡åˆ¥ 
- å°‡é€™å€‹æª”æ¡ˆæ”¾åœ¨äº† `core.interface.controller.dto` å¥—ä»¶ä¸‹ï¼Œä¸¦å°‡æª”æ¡ˆé‡å‘½åç‚º `ApiResponse.java`
- ç§»é™¤äº† `httpStatusCode` æ¬„ä½
#### æ§åˆ¶å™¨æ¥å£
- failure()æ”¹ç‚ºerror()
- response()çš„å…¥åƒæ”¹ç‚ºApiResponse,httpStatusCode
#### æ§åˆ¶å™¨åŸºé¡
- BaseControllerçš„åº•å±¤æ”¹ç”¨Springçš„ResponseEntityå¯¦ç¾
- successç”¨ok,200
- errorç”¨Bad Request,400
- responseå‰‡æ ¹æ“šå‚³å…¥çš„httpStatusCodeï¼Œè‹¥ç„¡ï¼Œå‰‡é è¨­ç‚º200
### å¯¦ä½œæ§åˆ¶å™¨
- é¦–é 
```
/**
 * é¦–é æ§åˆ¶å™¨
 * è² è²¬è™•ç†ç³»çµ±åŸºæœ¬ä¿¡æ¯ç›¸é—œçš„ HTTP è«‹æ±‚
 */
@RestController
@RequestMapping("/api")

 /**
     * ç³»çµ±é¦–é  API - GET è«‹æ±‚
     * æä¾›ç³»çµ±åŸºæœ¬ä¿¡æ¯å’Œç‹€æ…‹
     * 
     * @return ç³»çµ±ä¿¡æ¯å›æ‡‰
     */
    @GetMapping("/index")
```
- åº«å­˜
```
/**
 * åº«å­˜æ§åˆ¶å™¨
 * è² è²¬è™•ç†åº«å­˜ç›¸é—œçš„ HTTP è«‹æ±‚
 */
@RestController
@RequestMapping("/api/stock")

/**
     * è®Šæ›´åº«å­˜ - POST è«‹æ±‚
     * 
     * @param input åº«å­˜ç•°å‹•è¼¸å…¥åƒæ•¸
     * @return åº«å­˜ç•°å‹•çµæœ
     */
    @PostMapping("/movement")
```

## æ€è€ƒ
- å…¶ä»–


## è³‡æ–™
- é©—è­‰
```
ğŸ“¦ 1. DTO å±¤ï¼ˆå¦‚ CreateStockMovementInputï¼‰
è² è²¬ï¼šæ ¼å¼æ­£ç¢ºæ€§ã€åŸºæœ¬å®Œæ•´æ€§æª¢æŸ¥ï¼ˆçµæ§‹é©—è­‰ï¼‰

æª¢æŸ¥é …ç›®	ç¯„ä¾‹
å¿…å¡«æ¬„ä½	@NotNull(itemId)ã€@NotBlank(location)
æ ¼å¼æˆ–å€¼åŸŸé™åˆ¶	@Min(1)ã€@Size(max=100)
æ¬„ä½æœ¬èº«æ˜¯å¦åˆæ³•ï¼ˆä¸æ˜¯é‚è¼¯ï¼‰	æ•¸é‡æ˜¯å¦ç‚ºéè² ã€å­—ä¸²é•·åº¦ç­‰

ğŸ“Œ é€šå¸¸ä½¿ç”¨ Hibernate Validatorï¼ˆJSR-380ï¼‰ç­‰å·¥å…·æ­é… @Valid é©—è­‰ã€‚
ğŸ“Œ é€šå¸¸åœ¨ Controller æˆ– UseCase å…¥åƒè™•å‘¼å« Validator.validate()ã€‚

ğŸ§  2. UseCase å±¤ï¼ˆå¦‚ CreateStockMovementUseCaseImplï¼‰
è² è²¬ï¼šæ¥­å‹™é‚è¼¯ä¸Šçš„åˆæ³•æ€§ï¼ˆæ¥­å‹™é©—è­‰ï¼‰

æª¢æŸ¥é …ç›®	ç¯„ä¾‹
å•†å“ ID æ˜¯å¦å­˜åœ¨	æŸ¥è³‡æ–™åº«æ˜¯å¦æ‰¾å¾—åˆ°è©² item
åº«å­˜ç•°å‹•é¡å‹æ˜¯å¦åˆæ³•	æ˜¯å¦ç‚º enum ä¸­å®šç¾©çš„ç•°å‹•é¡å‹
ç•¶å‰åº«å­˜æ˜¯å¦è¶³å¤ å‡ºåº«	currentStock >= quantityChange
æ˜¯å¦é‡è¤‡æäº¤ã€æ˜¯å¦å¯ç·¨è¼¯ç­‰	èˆ‡ç›®å‰åº«å­˜ç‹€æ…‹ã€æ™‚é–“ã€è§’è‰²æ¬Šé™ç­‰é‚è¼¯æœ‰é—œçš„é©—è­‰

ğŸ“Œ é€™äº›å±¬æ–¼ å•†æ¥­è¦å‰‡ï¼ˆBusiness Rulesï¼‰ï¼Œæ‡‰ç”± UseCase ä¸»å°ï¼Œä¸æ‡‰è©²å¯«åœ¨ DTOã€‚
```